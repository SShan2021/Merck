YAC <- c(0, 0, 0.3, 0.3)
DFA <- c(0, 0, 0.1, 0.1)
HAK <- c(0, 0, 0.1, 0.1)
HGC <- c(0, 0, 0.1, 0.1)
HGU <- c(0, 0, 0.2, 0.2)
HMD <- c(0, 0, 0.2, 0.2)
HBB <- c(0, 0, 0.3, 0.3)
NAN <- c(0, 0, 0.3, 0.3)
BJF <- c(0, 0, 0.1, 0.1)
DDA <- c(0, 0, 0.1, 0.1)
DDJ <- c(0, 0, 0.2, 0.2)
DDQ <- c(0, 0, 0.2, 0.2)
XBH <- c(0, 0, 0.3, 0.3)
BDG <- c(0, 0, 0.3, 0.3)
#drug interaction effects
DDJ_DDQ <- c(0, 0, 0, 0.1)
DDJ_HBB <- c(0, 0, 0, 0.2)
DDJ_XBH <- c(0, 0, 0, 0.3)
DDQ_HBB <- c(0, 0, 0, 0.15)
DDQ_XBH <- c(0, 0, 0, 0.2)
HBB_XBH <- c(0, 0, 0, 0.3)
AAI_BDG <- c(0, 0, 0, 0.1)
AAI_BIC <- c(0, 0, 0, 0.4)
AAI_BIP <- c(0, 0, 0, 0.1)
AAI_HAG <- c(0, 0, 0, 0.2)
AAI_HAP <- c(0, 0, 0, 0.3)
AAI_HCC <- c(0, 0, 0, 0.1)
BDG_BIC <- c(0, 0, 0, 0.1)
BDG_BIP <- c(0, 0, 0, 0.2)
BDG_HAG <- c(0, 0, 0, 0.2)
############################
## Create grid giving simulation scenarios
############################
grid <- expand.grid(n = n, TXGROUP.4, TXGROUP.8, TXGROUP.16, SEX.F,
RACE.Black, RACE.Hispanic, RACE.Other, AAI,
GCC, YAC, DFA, HAK, HGC, HGU, HMD,
HBB, NAN, BJF, DDA, DDJ, DDQ, XBH, BDG,
DDJ_DDQ,  DDJ_HBB, DDJ_XBH, DDQ_HBB,
DDQ_XBH, HBB_XBH, AAI_BDG, AAI_BIC,
AAI_BIP, AAI_HAG, AAI_HAP, AAI_HCC,
BDG_BIC, BDG_BIP, BDG_HAG)
############################
## Create grid giving simulation scenarios
############################
grid <- expand.grid(n = n, TXGROUP.4=TXGROUP.4,
TXGROUP.8=TXGROUP.8, TXGROUP.16=TXGROUP.16,
SEX.F=SEX.F, RACE.Black=RACE.Black,
RACE.Hispanic=RACE.Hispanic,
RACE.Other=RACE.Other, AAI=AAI,
GCC=GCC, YAC=YAC, DFA=DFA, HAK=HAK, HGC=HGC,
HGU=HGU, HMD=HMD, HBB=HBB,
NAN=NAN, BJF=BJF) DDA, DDJ, DDQ, XBH, BDG,
grid <- expand.grid(n = n, TXGROUP.4=TXGROUP.4,
TXGROUP.8=TXGROUP.8, TXGROUP.16=TXGROUP.16,
SEX.F=SEX.F, RACE.Black=RACE.Black,
RACE.Hispanic=RACE.Hispanic,
RACE.Other=RACE.Other, AAI=AAI,
GCC=GCC, YAC=YAC, DFA=DFA, HAK=HAK, HGC=HGC,
HGU=HGU, HMD=HMD, HBB=HBB,
NAN=NAN, BJF=BJF)
grid <- expand.grid(n = n, TXGROUP.4=TXGROUP.4,
TXGROUP.8=TXGROUP.8, TXGROUP.16=TXGROUP.16,
SEX.F=SEX.F, RACE.Black=RACE.Black,
RACE.Hispanic=RACE.Hispanic,
RACE.Other=RACE.Other, AAI=AAI,
GCC=GCC, YAC=YAC, DFA=DFA, HAK=HAK, HGC=HGC,
HGU=HGU, HMD=HMD, HBB=HBB,
NAN=NAN, BJF=BJF)
runif(1, min = -1, max = 1)
runif(1, min = -1, max = 1)
############################
#load the necessary packages
############################
load_all("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/7-GitHub/mercksimulation/")
library("tidyverse")
library("devtools")
load_all("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/7-GitHub/mercksimulation/")
n_total <- rep(n, 4) #for all 4 models
load_all("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/7-GitHub/mercksimulation/")
############################
#create the simulation scenarios
############################
n <- c(500, 1000, 1500) # sample size
n_total <- rep(n, 4) #for all 4 models
n_total
#demographic effects
demo_effects <- c("TXGROUP.4", "TXGROUP.8", "TXGROUP.16",
"SEX.F", "RACE.Black", "RACE.Hispanic",
"RACE.Other")
for(i in 1:length(demo_effects)){
paste0(demo_effects[i]) <- generate_beta(length_zero = 3,
length_value = )
}
paste0(demo_effects[i])
for(i in 1:length(demo_effects)){
assign(demo_effects[i], generate_beta(length_zero = 3, length_value = 9))
}
TXGROUP.4
n <- c(500, 1000, 1500) # sample size
n_total <- rep(n, 4) #sample size for all 4 models
#demographic effects
demo_effects <- c("TXGROUP.4", "TXGROUP.8", "TXGROUP.16",
"SEX.F", "RACE.Black", "RACE.Hispanic",
"RACE.Other")
#generate the betas
lapply(demo_effects, function(x)
assign(x, generate_beta(length_zero = 3, length_value = 9),
envir = .GlobalEnv))
############################
#load packages
############################
#install.packages("tidyverse")
#install.packages("caret")
#install.packages("glmnet")
#install.packages("devtools")
#install_github("SShan2021/mercksimulation")
library("tidyverse")
library("devtools")
library("mercksimulation")
load_all("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/7-GitHub/mercksimulation/")
############################
#create the simulation scenarios
############################
n <- c(500, 1000, 1500) # sample size
n_total <- rep(n, 4) #sample size for all 4 models
#demographic effects
demo_effects <- c("TXGROUP.4", "TXGROUP.8", "TXGROUP.16",
"SEX.F", "RACE.Black", "RACE.Hispanic",
"RACE.Other")
#generate the betas
lapply(demo_effects, function(x)
assign(x, generate_beta(length_zero = 3, length_value = 9),
envir = .GlobalEnv))
TXGROUP.4
TXGROUP.8
TXGROUP.16
#generate the betas
sapply(demo_effects, function(x)
assign(x, generate_beta(length_zero = 3, length_value = 9),
envir = .GlobalEnv))
#generate the betas
demo_effects_betas <- sapply(demo_effects, function(x)
assign(x, generate_beta(length_zero = 3, length_value = 9)))
############################
#load packages
############################
#install.packages("tidyverse")
#install.packages("caret")
#install.packages("glmnet")
#install.packages("devtools")
#install_github("SShan2021/mercksimulation")
library("tidyverse")
library("devtools")
library("mercksimulation")
load_all("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/7-GitHub/mercksimulation/")
############################
#create the simulation scenarios
############################
n <- c(500, 1000, 1500) # sample size
n_total <- rep(n, 4) #sample size for all 4 models
###############
#demographic effects
###############
demo_effects <- c("TXGROUP.4", "TXGROUP.8", "TXGROUP.16",
"SEX.F", "RACE.Black", "RACE.Hispanic",
"RACE.Other")
#generate the betas
demo_effects_betas <- sapply(demo_effects, function(x)
assign(x, generate_beta(length_zero = 3, length_value = 9)))
demo_effects_betas
###############
#drug effects (main)
###############
drug_effects <- c("AAI", "GCC", "YAC", "DFA",
"HAK", "HGC", "HGU", "HMD",
"HBB", "NAN", "BJF", "DDA",
"DDJ", "DDQ", "XBH", "BDG")
#generate the betas
drug_effects_betas <- sapply(drug_effects, function(x)
assign(x, generate_beta(length_zero = 6, length_value = 6)))
drug_effects_betas
?generate_beta
??generate_beta
drug_interaction <- c("DDJ_DDQ", "DDJ_HBB", "DDJ_XBH",
"DDQ_HBB", "DDQ_XBH", "HBB_XBH",
"AAI_BDG", "AAI_BIC", "AAI_BIP",
"AAI_HAG", "AAI_HAP", "AAI_HCC",
"BDG_BIC", "BDG_BIP", "BDG_HAG")
#generate the betas
drug_interaction_betas <- sapply(drug_interaction, function(x)
assign(x, generate_beta(length_zero = 9, length_value = 3)))
drug_interaction
drug_interaction_betas
#generate the betas
drug_interaction_betas <- sapply(drug_interaction, function(x)
assign(x, generate_beta(length_zero = 9, length_value = 3)))
drug_interaction_betas
############################
## Create grid giving simulation scenarios
############################
grid <- cbind(n_total,
demo_effects_betas,
drug_effects_betas,
drug_interaction_betas)
grid
grid <- as.data.frame(grid)
saveRDS(grid, "/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/2-Processed Data/grid_initial.rds")
############################
#load packages
############################
install_github("SShan2021/mercksimulation")
library("mercksimulation")
############################
#load the data
############################
data <- read_csv("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/2-Processed Data/simulation.csv")
data[,1] <- NULL #delete the extra column
############################
#load the simulation grid
############################
grid <- readRDS("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/2-Processed Data/grid_initial.rds")
############################
#replace the column names
############################
colnames(data) <- gsub("-", "_", colnames(data))
write.csv("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/2-Processed Data/simulation.csv")
write.csv(data, "/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/2-Processed Data/simulation.csv")
############################
#load the data
############################
data <- read_csv("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/2-Processed Data/simulation.csv")
data[,1] <- NULL #delete the extra column
colnames(data)
?generate_beta
?mercksimulation::generate_beta
############################
#load packages
############################
#install.packages("tidyverse")
#install.packages("caret")
#install.packages("glmnet")
#install.packages("devtools")
install_github("SShan2021/mercksimulation")
load_all("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/7-GitHub/mercksimulation/")
?generate_beta
############################
#replace the column names
############################
data_x <- sample_x(data, 1000)
data_x
grid[10,]
############################
#
############################
grid[1, c("n_total")]
############################
#
############################
parameter <- grid[1, c("n_total")]
############################
#
############################
parameter <- grid[1, ]
############################
#run the simulation
############################
args <- commandArgs(TRUE)
parameter
parameter$n_total
load_all("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/7-GitHub/mercksimulation/")
q[,-c("AE")]
q[,c("AE")]
q[,"AE"]
q <- simulate_data(data, 1000, grid[10,], check_beta = "no")
q[,-c("AE")]
q
q <- simulate_data(data, 1000, grid[10,], check_beta = "no")
q <- simulate_data(df = data,
parameter_list = grid[10,],
check_beta = "no")
?simulate_data
?cv.glmnet
q[,-c("AE")]
q.v1 <- subset(q, select = -AE)
colnames(q.v1)
table(colnames(q.v1) == "AE")
q.v2 <- subset(q, select = AE)
q.v2
p <- simulate_data(df = data,
parameter_list = grid[10,],
check_beta = "yes")
table(p$AE)
prop.table(p$AE)
prop(table(p$AE))
prop.table(table(p$AE))
prop.table(table(q$AE))
q.v2 <- subset(q, select = AE)
q.v2
load_all("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/7-GitHub/mercksimulation/")
l <- lasso_function(df = q)
load_all("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/7-GitHub/mercksimulation/")
l <- lasso_function(df = q)
load_all("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/7-GitHub/mercksimulation/")
l <- lasso_function(df = q)
library("glmnet")
l <- lasso_function(df = q)
l
parameter
parameter
beta_real <- subset(parameter, select = -n_total)
beta_real
as.numeric(beta_real)
l
l$COEF
parameter
as.data.frame(parameter)
as.data.frame(t(parameter))
p <- as.data.frame(t(parameter))
p$COEF <- rownames(p)
p
p$DRUG <- rownames(p)
p <- as.data.frame(t(parameter))
p$DRUG <- rownames(p)
p
colnames(p) <- c("COEF", "DRUG")
p
length(p)
dim(p)
dim(p)[1]
rownames(p) <- 1:dim(p)[1]
p
p <- as.data.frame(t(subset(parameter, select = -n_total)))
p$DRUG <- rownames(p)
colnames(p) <- c("COEF", "DRUG")
rownames(p) <- 1:dim(p)[1]
p
p %>%
left_join(l, by = "DRUG")
beta <- p %>%
left_join(l, by = "DRUG")
colnames(beta)
colnames(beta) <- c("COEF.PAR",
"DRUG",
"COEF.SIM")
beta
beta[,"COEF.PAR"]
mean((beta[,"COEF.PAR"] - beta[,"COEF.SIM"])^2)
beta <- beta %>%
mutate_all(~ifelse(is.na(.),
0,
.))
mean((beta[,"COEF.PAR"] - beta[,"COEF.SIM"])^2)
sum(ifelse(beta[,"COEF.PAR"] == 0, 1, 0))
load_all("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/7-GitHub/mercksimulation/")
validation_function(parameter_list = grid[10,],
simulation_list = l)
load_all("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/7-GitHub/mercksimulation/")
validation_function(parameter_list = grid[10,],
simulation_list = l)
c <- 3
a <- 1
b <- 2
c <- 3
load_all("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/7-GitHub/mercksimulation/")
validation_function(parameter_list = grid[10,],
simulation_list = l)
load_all("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/7-GitHub/mercksimulation/")
validation_function(parameter_list = grid[10,],
simulation_list = l)
load_all("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/7-GitHub/mercksimulation/")
subset(parameter_list, "n_total")
subset(p, "n_total")
subset(p, n_total)
subset(parameter, n_total)
subset(parameter, select = n_total)
parameter$n_total
load_all("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/7-GitHub/mercksimulation/")
o <- simulation_function(df = data,
parameter_list = grid[1,])
load_all("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/7-GitHub/mercksimulation/")
o <- simulation_function(df = data,
parameter_list = grid[1,])
load_all("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/7-GitHub/mercksimulation/")
o <- simulation_function(df = data,
parameter_list = grid[1,])
o
load_all("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/7-GitHub/mercksimulation/")
saveRDS(grid, "/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/5-Code/Simulation/grid_initial.rds")
?simulation_function
simulation_function
output <- mercksimulation::simulation_function(df = data,
grid[nscenario,],
n_rep = 100)
output <- mercksimulation::simulation_function(df = data,
grid[1,],
n_rep = 100)
grid
colnames(data) <- gsub("-", "_", colnames(data))
colnames(data)
?gsub
############################
#install packages
############################
#install.packages("stringr")
library("stringr")
library("tidyverse")
library("devtools")
#install_github("SShan2021/mercksimulation")
library("mercksimulation")
#load_all("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/7-GitHub/mercksimulation/")
############################
#set the working directory
############################
setwd("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/2-Processed Data/simulation_sc12_n1000/")
############################
#upload the grid
############################
grid <- readRDS("/Users/sophshan/Library/CloudStorage/OneDrive-SharedLibraries-UniversityofNorthCarolinaatChapelHill/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/5-Code/Simulation/grid_initial.rds")
############################
#list all the .rdata files
############################
# Assuming your .RData files are in the current working directory
# List all .RData files
files <- list.files(pattern = "\\.RData$")
# Initialize an empty list to store data frames (optional, if you want to combine them later)
all_data_frames <- list()
# Loop through each file
for (file_name in files) {
# Load the .RData file
obj <- load(file_name)
# Generate a new name
new_name <- paste(file_name, sep = "_")
# Assign the object to a new name in the environment
assign(new_name, get(obj))
# Extract the base name of the file without extension for further manipulation
#base_name <- tools::file_path_sans_ext(file_name)
# Assuming the data frame's name inside the .RData matches the file name
# Dynamically access the data frame using get()
df <- get(file_name)
# Extract numbers after 'model' and 'n' from the file name
numbers_after_model <- str_extract(file_name, "(?<=model)\\d+")
numbers_after_n <- str_extract(file_name, "(?<=n)\\d+")
# Extract only the validation information from dataframe
df <- df$validation
# Bind together this dataframe
df <- do.call(rbind, df)
# Add these numbers as new columns to the data frame
df$model <- as.numeric(numbers_after_model)
df$sample_size <- as.numeric(numbers_after_n)
# Add the modified data frame to the list (if you plan to combine them later)
all_data_frames[[file_name]] <- df
}
#Combine all data frames into a single one
combined_df <- do.call(rbind, all_data_frames)
combined_df$model <- as.factor(combined_df$model)
combined_df$sample_size <- as.factor(combined_df$sample_size)
############################
#plot the MSE
############################
combined_df %>%
ggplot(aes(x = model, y = mse, group = model,
color = sample_size)) +
geom_boxplot()
############################
#plot the specificity
############################
combined_df %>%
ggplot(aes(x = model, y = specificity, group = model,
color = sample_size)) +
geom_boxplot()
View(output_model12_rep1000_n1500.RData)
output_model12_rep1000_n1500.RData$coefficients[[1]]
output_model12_rep1000_n1500.RData$validation[[1]]
output_model12_rep1000_n1500.RData$validation[[2]]
output_model12_rep1000_n1500.RData$validation[[3]]
validation_function()
validation_function
install_github("SShan2021/mercksimulation")
#install_github("SShan2021/mercksimulation")
library("mercksimulation")
validation_function
?validation_function
#install_github("SShan2021/mercksimulation")
library("mercksimulation")
load_all("/Users/sophshan/Desktop/XTan Group/XTAN group - Summer project on iEMA platform - SHAN Research/Merck/7-GitHub/mercksimulation/")
validation_function
install_github("SShan2021/mercksimulation")
library("mercksimulation")
validation_function
############################
#plot the specificity
############################
combined_df %>%
ggplot(aes(x = model, y = specificity, group = model,
color = sample_size)) +
geom_boxplot() +
ylim(0.85, 1)
############################
#plot the sensitivity
############################
combined_df %>%
ggplot(aes(x = model, y = sensitivity, group = model,
color = sample_size)) +
geom_boxplot()
############################
#plot the specificity
############################
combined_df %>%
ggplot(aes(x = model, y = specificity, group = model,
color = sample_size)) +
geom_boxplot() +
ylim(0.85, 1)
